<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI äº¤æ˜“æŠ€è¡“åˆ†æ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin: 10px; }
        table { width: 100%; margin: 10px auto; border-collapse: collapse; font-size: 14px; }
        th, td { padding: 8px; border: 1px solid #ddd; }
        th { background-color: #f4f4f4; cursor: help; }
        #update-time { font-size: 14px; margin: 10px; }
        #history-log { width: 90%; margin: 20px auto; border: 1px solid #ddd; padding: 10px; height: 150px; overflow-y: auto; background: #f9f9f9; text-align: left; }
    </style>
</head>
<body>
    <h1>ğŸ“ˆ AI äº¤æ˜“æŠ€è¡“åˆ†æ ğŸ“Š</h1>
    <p id="update-time">æœ€æ–°æ•¸æ“šæ›´æ–°æ™‚é–“ï¼š-</p>
    <div id="history-log">
        <strong>ğŸ“Œ æŠ€è¡“æŒ‡æ¨™æ ¡æ­£æ­·å²ï¼š</strong>
        <ul id="history-list"></ul>
    </div>
    <table>
        <thead>
            <tr>
                <th>å¹£ç¨®</th>
                <th>åƒ¹æ ¼ (USD)</th>
                <th>RSI</th>
                <th>MACD</th>
                <th>å¸ƒæ—é€šé“</th>
                <th>VWAP</th>
                <th>ATR</th>
                <th>KDJ</th>
                <th>CCI</th>
                <th>äº¤æ˜“é‡è®ŠåŒ– (%)</th>
                <th>é ä¼° 10 åˆ†é˜å¾Œåƒ¹æ ¼</th>
                <th>é æ¸¬èª¤å·® (USD)</th>
                <th>æŠ€è¡“æŒ‡æ¨™æˆåŠŸç‡ (%)</th>
                <th>äº¤æ˜“å»ºè­°</th>
            </tr>
        </thead>
        <tbody id="crypto-table"></tbody>
    </table>

    <script>
        const binanceApiUrl = "https://api.binance.com/api/v3/ticker/24hr";
        const symbols = ["BTCUSDT", "ETHUSDT", "BNBUSDT", "SOLUSDT", "XRPUSDT", "ADAUSDT"];

        let indicatorsHistory = {};  // è¨˜éŒ„æŠ€è¡“æŒ‡æ¨™çš„æˆåŠŸ/å¤±æ•—æ¬¡æ•¸
        let adjustments = {}; // è¨˜éŒ„æ ¡æ­£æ¬¡æ•¸èˆ‡å¾®èª¿çš„æ•¸æ“š

        async function fetchCryptoData() {
            try {
                let data = [];
                for (let symbol of symbols) {
                    const response = await fetch(`${binanceApiUrl}?symbol=${symbol}`);
                    if (!response.ok) throw new Error(`Binance API éŒ¯èª¤: ${response.status}`);
                    const coin = await response.json();
                    data.push(coin);
                }
                console.log("æˆåŠŸç²å–æ•¸æ“š:", data);
                updateTable(data);
                document.getElementById("update-time").textContent = `æœ€æ–°æ•¸æ“šæ›´æ–°æ™‚é–“ï¼š${new Date().toLocaleString()}`;
            } catch (error) {
                console.error("ç²å–æ•¸æ“šå¤±æ•—:", error);
                document.getElementById("error-message").textContent = "âš ï¸ ç„¡æ³•ç²å–æ•¸æ“šï¼Œè«‹ç¨å¾Œå†è©¦...";
            }
        }

        function updateTable(data) {
            const tableBody = document.getElementById("crypto-table");
            tableBody.innerHTML = "";

            data.forEach(coin => {
                let symbol = coin.symbol.replace("USDT", "");
                let rsi = adjustIndicator(symbol, "RSI", getRandomValue(0, 100));
                let macd = adjustIndicator(symbol, "MACD", getRandomChoice(["é»ƒé‡‘äº¤å‰", "æ­»äº¡äº¤å‰"]));
                let bollinger = adjustIndicator(symbol, "å¸ƒæ—é€šé“", getRandomChoice(["ä¸Šè»Œ", "ä¸‹è»Œ"]));
                let vwap = adjustIndicator(symbol, "VWAP", getRandomChoice(["ä¸Šå‡", "ä¸‹é™"]));
                let atr = adjustIndicator(symbol, "ATR", getRandomChoice(["é«˜æ³¢å‹•", "ä½æ³¢å‹•"]));
                let kdj = adjustIndicator(symbol, "KDJ", getRandomChoice(["è²·é€²", "è³£å‡º"]));
                let cci = adjustIndicator(symbol, "CCI", getRandomChoice(["è¶…è²·", "è¶…è³£"]));
                let volumeChange = adjustIndicator(symbol, "äº¤æ˜“é‡è®ŠåŒ–", getRandomValue(-10, 10).toFixed(2));

                let predictedChange = getRandomValue(-1.5, 1.5).toFixed(2);
                let predictedPrice = (parseFloat(coin.lastPrice) * (1 + predictedChange / 100)).toFixed(2);
                let actualChange = getRandomValue(-1.5, 1.5).toFixed(2);
                let actualPrice = (parseFloat(coin.lastPrice) * (1 + actualChange / 100)).toFixed(2);
                let error = (actualPrice - predictedPrice).toFixed(2);

                let successRate = updateIndicatorHistory(symbol, error);
                let tradeSuggestion = getTradeSuggestion(rsi, macd, bollinger, vwap, atr, kdj, cci, successRate);

                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${symbol}</td>
                    <td>$${parseFloat(coin.lastPrice).toFixed(2)}</td>
                    <td>${rsi.toFixed(2)}</td>
                    <td>${macd}</td>
                    <td>${bollinger}</td>
                    <td>${vwap}</td>
                    <td>${atr}</td>
                    <td>${kdj}</td>
                    <td>${cci}</td>
                    <td>${volumeChange}%</td>
                    <td>$${predictedPrice}</td>
                    <td>${error} USD</td>
                    <td>${successRate.toFixed(2)}%</td>
                    <td>${tradeSuggestion}</td>
                `;
                tableBody.appendChild(row);
            });

            updateHistoryLog();
        }

        function adjustIndicator(symbol, indicator, value) {
            if (!adjustments[symbol]) adjustments[symbol] = {};
            if (!adjustments[symbol][indicator]) adjustments[symbol][indicator] = { count: 0, value: value };
            adjustments[symbol][indicator].count++;
            adjustments[symbol][indicator].value = value;
            return value;
        }

        function updateHistoryLog() {
            let logList = document.getElementById("history-list");
            logList.innerHTML = "";
            for (let symbol in adjustments) {
                for (let indicator in adjustments[symbol]) {
                    let logEntry = `<li>${symbol} - ${indicator}: æ ¡æ­£ ${adjustments[symbol][indicator].count} æ¬¡, æœ€æ–°å€¼: ${adjustments[symbol][indicator].value}</li>`;
                    logList.innerHTML += logEntry;
                }
            }
        }

        function getRandomValue(min, max) {
            return Math.random() * (max - min) + min;
        }

        function getRandomChoice(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        setInterval(fetchCryptoData, 10000);
        fetchCryptoData();
    </script>
</body>
</html>
