<!DOCTYPE html>
<html>
<head>
    <title>台股深度分析工具</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .card { margin-top: 20px; }
        .signal-badge { margin: 2px; font-size: 0.9em; }
        .fair-value { background: #f8f9fa; padding: 15px; border-radius: 8px; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h3 class="text-center mb-4">台股技術分析與估值工具</h3>
        <div class="input-group" style="max-width: 400px; margin: 0 auto;">
            <input id="stockId" type="text" class="form-control" placeholder="輸入台股代號 (例:2330)">
            <button class="btn btn-primary" onclick="analyze()">分析</button>
        </div>
        
        <div id="result" style="display: none;">
            <!-- 價格與建議 -->
            <div class="card mt-4">
                <div class="card-body">
                    <h4 id="stockTitle" class="card-title"></h4>
                    <div id="recommendation" class="alert"></div>
                    <div class="row">
                        <div class="col-md-6">
                            <h5>技術信號</h5>
                            <div id="signals"></div>
                            <h5 class="mt-3">關鍵指標</h5>
                            <table class="table table-sm">
                                <tr><th>5日MA</th><td id="ma5"></td><th>RSI</th><td id="rsi"></td></tr>
                                <tr><th>20日MA</th><td id="ma20"></td><th>KD值</th><td><span id="k"></span>/<span id="d"></span></td></tr>
                                <tr><th>布林帶</th><td id="bollinger"></td><th>OBV</th><td id="obv"></td></tr>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <h5>估值模型</h5>
                            <div class="fair-value">
                                <div>市盈率法合理價：$<span id="fairPE"></span></div>
                                <div>股息模型合理價：$<span id="fairDDM"></span></div>
                                <div>布林中軌價格：$<span id="fairBollinger"></span></div>
                                <div class="mt-2">當前股價 vs 合理價：<span id="fairCompare"></span></div>
                            </div>
                            <h5 class="mt-3">基本面</h5>
                            <table class="table table-sm">
                                <tr><th>本益比 (P/E)</th><td id="pe"></td></tr>
                                <tr><th>每股盈餘 (EPS)</th><td id="eps"></td></tr>
                                <tr><th>股淨比 (P/B)</th><td id="pb"></td></tr>
                            </table>
                        </div>
                    </div>
                    <h5 class="mt-3">趨勢圖表</h5>
                    <canvas id="priceChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'YOUR_GOOGLE_SCRIPT_URL';

        let priceChart;

        function analyze() {
            const stockId = document.getElementById('stockId').value;
            fetch(`${API_URL}?stock_id=${stockId}`)
                .then(res => res.json())
                .then(data => {
                    if (data.error) throw new Error(data.error);
                    updateUI(data);
                    updateChart(data.historical);
                })
                .catch(err => alert('錯誤: ' + err.message));
        }

        function updateUI(data) {
            // 更新技術指標
            document.getElementById('ma5').textContent = data.indicators.MA5.toFixed(2);
            document.getElementById('ma20').textContent = data.indicators.MA20.toFixed(2);
            document.getElementById('rsi').textContent = data.indicators.RSI.toFixed(1);
            document.getElementById('k').textContent = data.indicators.K.toFixed(1);
            document.getElementById('d').textContent = data.indicators.D.toFixed(1);
            document.getElementById('obv').textContent = data.indicators.OBV.toLocaleString();

            // 更新估值
            document.getElementById('fairPE').textContent = data.fairValue.PE;
            document.getElementById('fairDDM').textContent = data.fairValue.DDM;
            document.getElementById('fairBollinger').textContent = data.fairValue.BollingerMid;
            document.getElementById('fairCompare').textContent = data.fairValue.CurrentVsFair;

            // 更新基本面
            document.getElementById('pe').textContent = data.fundamentals.PE.toFixed(2);
            document.getElementById('eps').textContent = data.fundamentals.EPS.toFixed(2);
            document.getElementById('pb').textContent = data.fundamentals.PB.toFixed(2);

            // ...其他UI更新...
        }

        function updateChart(historicalData) {
            if (priceChart) priceChart.destroy();
            const ctx = document.getElementById('priceChart').getContext('2d');
            priceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: historicalData.map(d => d.Date),
                    datasets: [{
                        label: '收盤價',
                        data: historicalData.map(d => d.Close),
                        borderColor: '#007bff',
                        tension: 0.1
                    }]
                }
            });
        }
    </script>
</body>
</html>
