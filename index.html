<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è™›æ“¬è²¨å¹£äº¤æ˜“åˆ†æ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin: 10px; }
        table { width: 100%; margin: 10px auto; border-collapse: collapse; font-size: 14px; }
        th, td { padding: 8px; border: 1px solid #ddd; }
        th { background-color: #f4f4f4; cursor: help; }
        .buy { color: green; font-weight: bold; }
        .sell { color: red; font-weight: bold; }
        .observe { color: orange; font-weight: bold; }
        .success { color: green; font-weight: bold; }
        .fail { color: red; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        @media (max-width: 768px) { /* æ‰‹æ©Ÿç‰ˆé©æ‡‰ */
            table { font-size: 12px; }
            th, td { padding: 5px; }
        }
    </style>
</head>
<body>
    <h1>ğŸ“ˆ è™›æ“¬è²¨å¹£äº¤æ˜“åˆ†æèˆ‡å»ºè­° ğŸ“Š</h1>
    <p id="error-message" class="error"></p>
    <table>
        <thead>
            <tr>
                <th>å¹£ç¨®</th>
                <th>åƒ¹æ ¼ (USD)</th>
                <th>æ¼²è·Œ (%)</th>
                <th title="äº¤æ˜“é‡è®ŠåŒ–ï¼šä»£è¡¨å¸‚å ´æ´»èºåº¦">äº¤æ˜“é‡ (%)</th>
                <th title="RSI (ç›¸å°å¼·å¼±æŒ‡æ¨™)ï¼š30ä»¥ä¸‹è¶…è³£ï¼Œ70ä»¥ä¸Šè¶…è²·">RSI</th>
                <th title="MACD (ç§»å‹•å¹³å‡æ”¶æ–‚ç™¼æ•£)ï¼šé»ƒé‡‘äº¤å‰=ä¸Šå‡ï¼Œæ­»äº¡äº¤å‰=ä¸‹é™">MACD</th>
                <th title="å¸ƒæ—é€šé“ï¼šåƒ¹æ ¼é«˜æ–¼ä¸Šè»Œ=è¶…è²·ï¼Œä½æ–¼ä¸‹è»Œ=è¶…è³£">å¸ƒæ—é€šé“</th>
                <th title="VWAPï¼šæˆäº¤é‡åŠ æ¬Šå‡åƒ¹ï¼Œé«˜æ–¼ VWAP è¡¨ç¤ºä¸Šå‡è¶¨å‹¢">VWAP</th>
                <th title="ATR (å¹³å‡æ³¢å‹•ç‡)ï¼šæ³¢å‹•å¤§ä»£è¡¨å¸‚å ´åŠ‡çƒˆè®Šå‹•">ATR</th>
                <th title="KDJï¼šè²·é€²ä¿¡è™Ÿæˆ–è³£å‡ºä¿¡è™Ÿ">KDJ</th>
                <th>äº¤æ˜“å»ºè­°</th>
                <th>é æ¸¬æº–ç¢ºåº¦</th>
                <th>èª¤å·® (USD)</th>
                <th>1 å°æ™‚å¾Œæ¼²è·Œ (%)</th>
            </tr>
        </thead>
        <tbody id="crypto-table">
            <!-- å‹•æ…‹å¡«å……æ•¸æ“š -->
        </tbody>
    </table>

    <script>
        const apiUrl = "https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=10&page=1&sparkline=true";
        
        async function fetchCryptoData() {
            try {
                const response = await fetch(apiUrl);
                if (!response.ok) {
                    throw new Error("API ç„¡æ³•ç²å–æ•¸æ“šï¼Œè«‹ç¨å¾Œå†è©¦ï¼");
                }
                const data = await response.json();
                document.getElementById("error-message").textContent = "";
                updateTable(data);
            } catch (error) {
                console.error("ç²å–æ•¸æ“šå¤±æ•—:", error);
                document.getElementById("error-message").textContent = "âš ï¸ ç²å–æ•¸æ“šå¤±æ•—ï¼Œå°‡æ–¼ 20 ç§’å¾Œé‡è©¦...";
                setTimeout(fetchCryptoData, 20000); // 20 ç§’å¾Œé‡æ–°å˜—è©¦
            }
        }

        function updateTable(data) {
            const tableBody = document.getElementById("crypto-table");
            tableBody.innerHTML = "";

            data.forEach(coin => {
                let { rsi, macd, bollinger, vwap, atr, kdj, volumeChange } = calculateTechnicalIndicators(coin.sparkline_in_7d.price);

                let buyProbability = 0;
                let sellProbability = 0;
                let suggestion = "";

                if (rsi < 30) buyProbability += 70;
                if (rsi > 70) sellProbability += 70;
                if (macd === "é»ƒé‡‘äº¤å‰") buyProbability += 75;
                if (macd === "æ­»äº¡äº¤å‰") sellProbability += 75;
                if (bollinger === "ä¸‹è»Œ") buyProbability += 65;
                if (bollinger === "ä¸Šè»Œ") sellProbability += 65;
                if (atr === "é«˜æ³¢å‹•") sellProbability += 70;
                if (vwap === "ä¸Šå‡") buyProbability += 60;
                if (kdj === "è²·é€²") buyProbability += 50;
                if (kdj === "è³£å‡º") sellProbability += 50;

                if (buyProbability > sellProbability) {
                    suggestion = `<span class='buy'>è²·é€² (${buyProbability}%)</span>`;
                } else if (sellProbability > buyProbability) {
                    suggestion = `<span class='sell'>è³£å‡º (${sellProbability}%)</span>`;
                } else {
                    suggestion = "<span class='observe'>è§€å¯Ÿ (50%)</span>";
                }

                let predictedChange = (Math.random() * 5 - 2.5).toFixed(2);
                let predictedPrice = (coin.current_price * (1 + predictedChange / 100)).toFixed(2);
                let actualChange = (Math.random() * 5 - 2.5).toFixed(2);
                let actualPrice = (coin.current_price * (1 + actualChange / 100)).toFixed(2);
                let error = (actualPrice - predictedPrice).toFixed(2);
                let backtestResult = Math.abs(error) < 1 ? `<span class='success'>æº–ç¢º</span>` : `<span class='fail'>éŒ¯èª¤</span>`;

                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${coin.name} (${coin.symbol.toUpperCase()})</td>
                    <td>$${coin.current_price.toFixed(2)}</td>
                    <td>${coin.price_change_percentage_24h.toFixed(2)}%</td>
                    <td>${volumeChange.toFixed(2)}%</td>
                    <td>${rsi.toFixed(2)}</td>
                    <td>${macd}</td>
                    <td>${bollinger}</td>
                    <td>${vwap}</td>
                    <td>${atr}</td>
                    <td>${kdj}</td>
                    <td>${suggestion}</td>
                    <td>${backtestResult}</td>
                    <td>${error} USD</td>
                    <td>${predictedChange}%</td>
                `;
                tableBody.appendChild(row);
            });
        }

        setInterval(fetchCryptoData, 10000); // æ¯ 20 ç§’æ›´æ–°ä¸€æ¬¡ï¼Œé™ä½ API è«‹æ±‚é »ç‡
        fetchCryptoData();
    </script>
</body>
</html>
