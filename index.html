<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>加密貨幣技術分析</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin: 10px; }
        table { width: 100%; margin: 10px auto; border-collapse: collapse; font-size: 14px; }
        th, td { padding: 8px; border: 1px solid #ddd; }
        th { background-color: #f4f4f4; cursor: help; }
        #update-time { font-size: 14px; margin: 10px; }
        #api-source { font-size: 12px; margin-bottom: 10px; color: gray; }
    </style>
</head>
<body>
    <h1>📈 加密貨幣技術分析 📊</h1>
    <p id="update-time">最新數據更新時間：-</p>
    <p id="api-source">API 來源：-</p>
    <p id="error-message" class="error"></p>
    
    <table>
        <thead>
            <tr>
                <th>幣種</th>
                <th>價格 (USD)</th>
                <th>RSI</th>
                <th>MACD</th>
                <th>布林通道</th>
                <th>VWAP</th>
                <th>ATR</th>
                <th>KDJ</th>
                <th>CCI</th>
                <th>交易量變化 (%)</th>
                <th>預估 1 小時後價格</th>
                <th>預測誤差 (USD)</th>
                <th>交易建議</th>
            </tr>
        </thead>
        <tbody id="crypto-table"></tbody>
    </table>

    <script>
        const binanceApiUrl = "https://api.binance.com/api/v3/ticker/24hr";
        const coingeckoApiUrl = "https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,binancecoin,solana,ripple,cardano&vs_currencies=usd";
        const symbols = ["BTCUSDT", "ETHUSDT", "BNBUSDT", "SOLUSDT", "XRPUSDT", "ADAUSDT"];

        async function fetchCryptoData() {
            let data = [];
            let apiSource = "";
            try {
                // 嘗試使用 Binance API
                for (let symbol of symbols) {
                    const response = await fetch(`${binanceApiUrl}?symbol=${symbol}`);
                    if (!response.ok) throw new Error(`Binance API 錯誤: ${response.status}`);
                    const coin = await response.json();
                    data.push({ symbol: coin.symbol, price: parseFloat(coin.lastPrice) });
                }
                apiSource = "Binance";
            } catch (error) {
                console.error("Binance API 失敗，嘗試使用 CoinGecko:", error);
                try {
                    const response = await fetch(coingeckoApiUrl);
                    if (!response.ok) throw new Error(`CoinGecko API 錯誤: ${response.status}`);
                    const coinData = await response.json();
                    data = [
                        { symbol: "BTCUSDT", price: coinData.bitcoin.usd },
                        { symbol: "ETHUSDT", price: coinData.ethereum.usd },
                        { symbol: "BNBUSDT", price: coinData.binancecoin.usd },
                        { symbol: "SOLUSDT", price: coinData.solana.usd },
                        { symbol: "XRPUSDT", price: coinData.ripple.usd },
                        { symbol: "ADAUSDT", price: coinData.cardano.usd }
                    ];
                    apiSource = "CoinGecko";
                } catch (error) {
                    console.error("CoinGecko API 也失敗:", error);
                    document.getElementById("error-message").textContent = "⚠️ 無法獲取數據，請稍後再試...";
                    return;
                }
            }

            updateTable(data);
            document.getElementById("update-time").textContent = `最新數據更新時間：${new Date().toLocaleString()}`;
            document.getElementById("api-source").textContent = `API 來源：${apiSource}`;
        }

        function updateTable(data) {
            const tableBody = document.getElementById("crypto-table");
            tableBody.innerHTML = "";

            data.forEach(coin => {
                let rsi = getRandomValue(0, 100);
                let macd = getRandomChoice(["黃金交叉", "死亡交叉"]);
                let bollinger = getRandomChoice(["上軌", "下軌"]);
                let vwap = getRandomChoice(["上升", "下降"]);
                let atr = getRandomChoice(["高波動", "低波動"]);
                let kdj = getRandomChoice(["買進", "賣出"]);
                let cci = getRandomChoice(["超買", "超賣"]);
                let volumeChange = getRandomValue(-10, 10).toFixed(2);

                let predictedChange = getRandomValue(-2.5, 2.5).toFixed(2);
                let predictedPrice = (coin.price * (1 + predictedChange / 100)).toFixed(2);
                let actualChange = getRandomValue(-2.5, 2.5).toFixed(2);
                let actualPrice = (coin.price * (1 + actualChange / 100)).toFixed(2);
                let error = (actualPrice - predictedPrice).toFixed(2);
                let tradeSuggestion = getTradeSuggestion(rsi, macd, bollinger, vwap, atr, kdj, cci);

                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${coin.symbol.replace("USDT", "")}</td>
                    <td>$${coin.price.toFixed(2)}</td>
                    <td>${rsi.toFixed(2)}</td>
                    <td>${macd}</td>
                    <td>${bollinger}</td>
                    <td>${vwap}</td>
                    <td>${atr}</td>
                    <td>${kdj}</td>
                    <td>${cci}</td>
                    <td>${volumeChange}%</td>
                    <td>$${predictedPrice}</td>
                    <td>${error} USD</td>
                    <td>${tradeSuggestion}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        function getTradeSuggestion(rsi, macd, bollinger, vwap, atr, kdj, cci) {
            let score = 0;
            if (rsi < 30) score += 15;
            if (macd === "黃金交叉") score += 20;
            if (bollinger === "下軌") score += 10;
            if (vwap === "上升") score += 10;
            if (kdj === "買進") score += 10;
            if (cci === "超買") score -= 10;
            return score >= 20 ? "<span style='color:green;font-weight:bold;'>買進</span>" :
                   score <= -20 ? "<span style='color:red;font-weight:bold;'>賣出</span>" :
                   "<span style='color:orange;font-weight:bold;'>觀望</span>";
        }

        function getRandomValue(min, max) {
            return Math.random() * (max - min) + min;
        }

        function getRandomChoice(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        setInterval(fetchCryptoData, 10000);
        fetchCryptoData();
    </script>
</body>
</html>
