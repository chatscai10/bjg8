<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI åŠ å¯†è²¨å¹£é æ¸¬</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin: 10px; }
        table { width: 100%; margin: 10px auto; border-collapse: collapse; font-size: 14px; }
        th, td { padding: 8px; border: 1px solid #ddd; }
        th { background-color: #f4f4f4; cursor: help; }
        #update-time { font-size: 14px; margin: 10px; }
        #history-log { width: 90%; margin: 20px auto; border: 1px solid #ddd; padding: 10px; height: 150px; overflow-y: auto; background: #f9f9f9; text-align: left; }
    </style>
</head>
<body>
    <h1>ğŸ“ˆ AI åŠ å¯†è²¨å¹£é æ¸¬ ğŸ“Š</h1>
    <p id="update-time">æœ€æ–°æ•¸æ“šæ›´æ–°æ™‚é–“ï¼š-</p>
    <p id="error-message" class="error" style="color: red;"></p>
    <div id="history-log">
        <strong>ğŸ“Œ æ­·å²æš´æ¼²å¹£åˆ†æçµæœï¼š</strong>
        <ul id="history-list"></ul>
    </div>
    <table>
        <thead>
            <tr>
                <th>å¹£ç¨®</th>
                <th>åƒ¹æ ¼ (USD)</th>
                <th>RSI</th>
                <th>MACD</th>
                <th>æ­·å²æ¼²å¹… (å€æ•¸)</th>
                <th>é ä¼°æ¼²å¹… (%)</th>
                <th>é ä¼°æ™‚é–“ (å¤©)</th>
                <th>é æ¸¬æ©Ÿç‡ (%)</th>
                <th>äº¤æ˜“å»ºè­°</th>
            </tr>
        </thead>
        <tbody id="crypto-table"></tbody>
    </table>

    <h2>ğŸ“Š å›æ¸¬æ•¸æ“šåˆ†æï¼ˆ1 å€‹æœˆå‰ vs. ä»Šæ—¥ï¼‰</h2>
    <table>
        <thead>
            <tr>
                <th>å¹£ç¨®</th>
                <th>1 å€‹æœˆå‰åƒ¹æ ¼</th>
                <th>ä»Šæ—¥åƒ¹æ ¼</th>
                <th>å¯¦éš›æ¼²å¹… (%)</th>
                <th>é æ¸¬ vs. å¯¦éš› èª¤å·®</th>
                <th>æŠ€è¡“æŒ‡æ¨™æº–ç¢ºç‡ (%)</th>
            </tr>
        </thead>
        <tbody id="backtest-table"></tbody>
    </table>

    <script>
        const binanceApiUrl = "https://api.binance.com/api/v3/ticker/24hr";
        const binanceKlinesApi = "https://api.binance.com/api/v3/klines";
        const coingeckoApiUrl = "https://api.coingecko.com/api/v3/simple/price";
        
        const symbols = [
            "BTCUSDT", "ETHUSDT", "BNBUSDT", "SOLUSDT", "XRPUSDT", "ADAUSDT",  
            "FLOKIUSDT", "PEPEUSDT", "ORDIUSDT", "ARBUSDT", "GALAUSDT", "MATICUSDT"
        ];

        let historyData = {}; // è¨˜éŒ„æ­·å¹´æš´æ¼²çš„å¹£ç¨®

        async function fetchCryptoData() {
            let data = [];
            try {
                for (let symbol of symbols) {
                    const response = await fetch(`${binanceApiUrl}?symbol=${symbol}`);
                    if (!response.ok) throw new Error(`Binance API éŒ¯èª¤: ${response.status}`);
                    const coin = await response.json();
                    data.push({ symbol: coin.symbol, price: parseFloat(coin.lastPrice) });
                }
            } catch (error) {
                console.warn("Binance API ç„¡æ³•ç²å–æ•¸æ“šï¼Œæ”¹ç”¨ CoinGecko API...");
                data = await fetchFromCoinGecko();
            }
            updateTable(data);
            fetchBacktestData(data);
            document.getElementById("update-time").textContent = `æœ€æ–°æ•¸æ“šæ›´æ–°æ™‚é–“ï¼š${new Date().toLocaleString()}`;
        }

        async function fetchFromCoinGecko() {
            try {
                let ids = "bitcoin,ethereum,binancecoin,solana,ripple,cardano,floki,pepe,ordi,arbitrum,gala,matic-network";
                let response = await fetch(`${coingeckoApiUrl}?ids=${ids}&vs_currencies=usd`);
                if (!response.ok) throw new Error("CoinGecko API å¤±æ•—");
                let data = await response.json();
                return Object.keys(data).map(key => ({
                    symbol: key.toUpperCase() + "USDT",
                    price: data[key].usd
                }));
            } catch (error) {
                console.error("CoinGecko API ä¹Ÿå¤±æ•—:", error);
                document.getElementById("error-message").textContent = "âš ï¸ ç„¡æ³•ç²å–æ•¸æ“šï¼Œè«‹ç¨å¾Œå†è©¦...";
                return [];
            }
        }

        async function fetchBacktestData(currentData) {
            let backtestData = [];
            for (let coin of currentData) {
                try {
                    let response = await fetch(`${binanceKlinesApi}?symbol=${coin.symbol}&interval=1d&limit=30`);
                    if (!response.ok) continue;
                    let history = await response.json();
                    let priceOneMonthAgo = parseFloat(history[0][4]);
                    backtestData.push({
                        symbol: coin.symbol,
                        priceOneMonthAgo,
                        priceToday: coin.price,
                        actualIncrease: ((coin.price - priceOneMonthAgo) / priceOneMonthAgo * 100).toFixed(2),
                    });
                } catch (error) {
                    console.warn(`ç„¡æ³•ç²å– ${coin.symbol} çš„å›æ¸¬æ•¸æ“š`);
                }
            }
            updateBacktestTable(backtestData);
        }

        function updateTable(data) {
            const tableBody = document.getElementById("crypto-table");
            tableBody.innerHTML = "";

            data.forEach(coin => {
                let symbol = coin.symbol.replace("USDT", "");
                let rsi = getRandomValue(20, 50);
                let macd = getRandomChoice(["é»ƒé‡‘äº¤å‰", "æ­»äº¡äº¤å‰"]);
                let historicalMultiplier = getHistoricalMultiplier(symbol);
                let estimatedIncrease = (historicalMultiplier * getRandomValue(50, 200)).toFixed(2);
                let estimatedDays = (historicalMultiplier * getRandomValue(5, 30)).toFixed(1);
                let predictionProbability = getRandomValue(50, 90).toFixed(2);
                let tradeSuggestion = getTradeSuggestion(rsi, macd, predictionProbability);

                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${symbol}</td>
                    <td>$${coin.price.toFixed(2)}</td>
                    <td>${rsi.toFixed(2)}</td>
                    <td>${macd}</td>
                    <td>${historicalMultiplier.toFixed(1)}x</td>
                    <td>${estimatedIncrease}%</td>
                    <td>${estimatedDays} å¤©</td>
                    <td>${predictionProbability}%</td>
                    <td>${tradeSuggestion}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        setInterval(fetchCryptoData, 60000);
        fetchCryptoData();
    </script>
</body>
</html>
