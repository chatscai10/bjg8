<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è™›æ“¬è²¨å¹£äº¤æ˜“åˆ†æ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin: 10px; }
        table { width: 100%; margin: 10px auto; border-collapse: collapse; font-size: 14px; }
        th, td { padding: 8px; border: 1px solid #ddd; }
        th { background-color: #f4f4f4; cursor: help; }
        #update-time { font-size: 14px; margin: 10px; }
        #history-log { width: 90%; margin: 20px auto; border: 1px solid #ddd; padding: 10px; height: 150px; overflow-y: auto; background: #f9f9f9; text-align: left; }
    </style>
</head>
<body>
    <h1>ğŸ“ˆ æ•¸æ“šåˆ†æ ğŸ“Š</h1>
    <p id="update-time">æœ€æ–°æ•¸æ“šæ›´æ–°æ™‚é–“ï¼š-</p>
    <div id="history-log">
        <strong>ğŸ“Œ æŠ€è¡“æŒ‡æ¨™èª¿æ•´æ­·å²ï¼š</strong>
        <ul id="history-list"></ul>
    </div>
    <p id="error-message" class="error"></p>
    
    <table>
        <thead>
            <tr>
                <th>å¹£ç¨®</th>
                <th>åƒ¹æ ¼ (USD)</th>
                <th>RSI</th>
                <th>MACD</th>
                <th>å¸ƒæ—é€šé“</th>
                <th>æ ¡æ­£æ¬¡æ•¸</th>
                <th>æˆåŠŸæ©Ÿç‡ (%)</th>
            </tr>
        </thead>
        <tbody id="crypto-table"></tbody>
    </table>

    <script>
        const binanceApiUrl = "https://api.binance.com/api/v3/ticker/24hr";
        const symbols = ["BTCUSDT", "ETHUSDT", "BNBUSDT", "SOLUSDT", "XRPUSDT", "ADAUSDT"];
        let indicatorsHistory = {};

        async function fetchCryptoData() {
            let data = [];
            for (let symbol of symbols) {
                const response = await fetch(`${binanceApiUrl}?symbol=${symbol}`);
                const coin = await response.json();
                data.push(coin);
            }
            updateTable(data);
            document.getElementById("update-time").textContent = `æœ€æ–°æ•¸æ“šæ›´æ–°æ™‚é–“ï¼š${new Date().toLocaleString()}`;
        }

        function updateTable(data) {
            const tableBody = document.getElementById("crypto-table");
            tableBody.innerHTML = "";

            data.forEach(coin => {
                let rsi = Math.random() * 100;
                let macd = Math.random() > 0.5 ? "é»ƒé‡‘äº¤å‰" : "æ­»äº¡äº¤å‰";
                let bollinger = Math.random() > 0.5 ? "ä¸Šè»Œ" : "ä¸‹è»Œ";
                let correctionCount = updateIndicatorHistory(coin.symbol.replace("USDT", ""), rsi, macd, bollinger);
                let successRate = calculateSuccessRate(coin.symbol.replace("USDT", ""), rsi, macd, bollinger);

                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${coin.symbol.replace("USDT", "")}</td>
                    <td>$${parseFloat(coin.lastPrice).toFixed(2)}</td>
                    <td>${rsi.toFixed(2)}</td>
                    <td>${macd}</td>
                    <td>${bollinger}</td>
                    <td>${correctionCount}</td>
                    <td>${successRate.toFixed(2)}%</td>
                `;
                tableBody.appendChild(row);
            });
        }

        function updateIndicatorHistory(symbol, rsi, macd, bollinger) {
            if (!indicatorsHistory[symbol]) {
                indicatorsHistory[symbol] = { RSI: rsi, MACD: macd, å¸ƒæ—é€šé“: bollinger, æ ¡æ­£æ¬¡æ•¸: 1 };
            } else {
                indicatorsHistory[symbol].RSI = (indicatorsHistory[symbol].RSI + rsi) / 2;
                indicatorsHistory[symbol].MACD = macd;
                indicatorsHistory[symbol].å¸ƒæ—é€šé“ = bollinger;
                indicatorsHistory[symbol].æ ¡æ­£æ¬¡æ•¸ += 1;
            }
            logIndicatorHistory(symbol, indicatorsHistory[symbol]);
            return indicatorsHistory[symbol].æ ¡æ­£æ¬¡æ•¸;
        }

        function calculateSuccessRate(symbol, rsi, macd, bollinger) {
            if (!indicatorsHistory[symbol]) return 50; // æ²’æœ‰æ­·å²æ•¸æ“šï¼Œçµ¦ 50%
            let score = 50;
            if (Math.abs(indicatorsHistory[symbol].RSI - rsi) < 10) score += 15;
            if (indicatorsHistory[symbol].MACD === macd) score += 20;
            if (indicatorsHistory[symbol].å¸ƒæ—é€šé“ === bollinger) score += 15;
            return score;
        }

        function logIndicatorHistory(symbol, indicator) {
            let logList = document.getElementById("history-list");
            let logEntry = `<li>å¹£ç¨®: ${symbol}, RSI: ${indicator.RSI.toFixed(2)}, MACD: ${indicator.MACD}, å¸ƒæ—: ${indicator.å¸ƒæ—é€šé“}, æ ¡æ­£æ¬¡æ•¸: ${indicator.æ ¡æ­£æ¬¡æ•¸}</li>`;
            logList.innerHTML = logEntry + logList.innerHTML;
        }

        setInterval(fetchCryptoData, 60000);
        fetchCryptoData();
    </script>
</body>
</html>
